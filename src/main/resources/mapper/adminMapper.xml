<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.binary.rapid.admin.mapper.AdminMapper">
    <select id="selectUserList" resultType="com.binary.rapid.admin.dto.AdminDto">
        SELECT user_id      AS userId
             , id           AS id
             , password     AS password
             , nickname     AS nickName
             , email        AS email
             , taste        AS taste
             , gender       AS gender
             , birth        AS birth
             , role         AS role
             , create_date  AS createDate
             , update_date  AS updateDate
             , delete_date  AS deleteDate
        FROM tb_user
        WHERE 1=1
        <if test="category != null and category != ''">
            AND taste = #{category}
        </if>
        
        <if test="keyword != null and keyword != ''">
            AND (nickname LIKE CONCAT('%', #{keyword}, '%') 
                 OR email LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        
        <if test="startDate != null and startDate != ''">
            AND create_date >= #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND create_date &lt;= CONCAT(#{endDate}, ' 23:59:59')
        </if>
        
        ORDER BY create_date DESC
    </select>
    
    <update id="updateUserStatusToSuspend">
        UPDATE tb_user
        SET delete_date = NOW()
        WHERE user_id = #{userId}
    </update>
    
    <update id="updateUserStatusToRestore">
        UPDATE tb_user
        SET delete_date = NULL
        WHERE user_id = #{userId}
    </update>

</mapper>


