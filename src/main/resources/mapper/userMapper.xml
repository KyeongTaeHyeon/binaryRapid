<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.binary.rapid.user.mapper.UserMapper">

    <!-- 회원가입 -->
    <insert id="insertUser"
            parameterType="com.binary.rapid.user.dto.UserDto"
            useGeneratedKeys="true"
            keyProperty="userId"
            keyColumn="user_id">
        INSERT INTO tb_user (id, password, nickname, name, taste,
                             birth, email, social, gender, role)
        VALUES (#{id},
                #{password},
                #{nickName},
                #{name},
                #{taste},
                #{birth},
                #{email},
                #{social},
                #{gender},
                #{role})
    </insert>

    <!-- 아이디 중복 체크 -->
    <select id="duplicateUserId"
            parameterType="string"
            resultType="int">
        SELECT COUNT(*)
        FROM tb_user
        WHERE id = #{id}
    </select>

    <!-- 아이디로 유저 조회 -->
    <select id="selectUserId"
            parameterType="string"
            resultType="com.binary.rapid.user.dto.UserResponseDto">
        SELECT *
        FROM tb_user
        WHERE id = #{id}
    </select>

    <select id="selectUserList" resultType="adminDto">
        SELECT user_id
             , id
             , password
             , nickname AS nickName
             , email
             , taste
             , gender
             , birth
             , role
             , create_date
             , update_date
             , delete_date
        FROM tb_user
        WHERE delete_date IS NULL
        
        <if test="category != null and category != ''">
            AND taste = #{category}
        </if>
        
        <if test="keyword != null and keyword != ''">
            AND (nickname LIKE CONCAT('%', #{keyword}, '%') 
                 OR email LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        
        <if test="startDate != null and startDate != ''">
            AND create_date >= #{startDate}
        </if>
        <if test="endDate != null and endDate != ''">
            AND create_date &lt;= CONCAT(#{endDate}, ' 23:59:59')
        </if>
        
        ORDER BY create_date DESC
    </select>

</mapper>
