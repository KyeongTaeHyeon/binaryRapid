<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8"/>
        <title>회원 관리</title>
        <meta name="_csrf" th:content="${_csrf?.token}"/>
        <meta name="_csrf_header" th:content="${_csrf?.headerName}"/>

        <link rel="stylesheet" th:href="@{/css/reset.css}"/>
        <link rel="stylesheet" th:href="@{/css/common.css}"/>
        <link rel="stylesheet" th:href="@{/css/admin.css}"/>
    </head>

    <body>
        <div id="wrapper">
            <header id="header" th:replace="~{fragments/header :: header}"></header>

            <main id="main" class="admin-container">
                <aside th:replace="~{fragments/sidebar :: sidebar(currentMenu='user')}"></aside>

                <section id="managerRight">
                    <div class="page-header">
                        <h2>회원 관리</h2>
                    </div>

                    <div class="search-container">
                        <form id="searchForm" action="/admin/users" method="get" class="search-wrap">
                            <select name="category" id="searchCategory">
                                <option value="">전체 취향</option>
                                <option th:each="item : ${tasteList}"
                                        th:value="${item.name}"
                                        th:text="${item.name}"
                                        th:selected="${search.category == item.name}">
                                    돈코츠
                                </option>
                            </select>

                            <input type="text" name="keyword" id="searchKeyword"
                                   placeholder="닉네임, 이메일 검색" th:value="${search.keyword}">

                            <div class="date-range">
                                <input type="date" name="startDate" id="startDate" th:value="${search.startDate}">
                                <span>~</span>
                                <input type="date" name="endDate" id="endDate" th:value="${search.endDate}">
                            </div>

                            <button type="submit" class="btn-search">검색</button>
                            <button type="button" class="btn-reset" onclick="resetSearch()">초기화</button>
                        </form>
                    </div>

                    <div class="table-top">
                        <span>총 <b style="color:#2fb2ee" th:text="${#lists.size(users)}">0</b>명</span>
                    </div>

                    <table class="list-table">
                        <thead>
                        <tr>
                            <th width="5%"><input type="checkbox" id="checkAll"></th>
                            <th width="5%">No</th>
                            <th width="15%">닉네임</th>
                            <th width="20%">이메일</th>
                            <th width="10%">취향</th>
                            <th width="5%">나이</th>
                            <th width="5%">성별</th>
                            <th width="15%">가입일</th>
                            <th width="15%">관리</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:if="${#lists.isEmpty(users)}">
                            <td colspan="9" style="padding: 50px 0;">검색 결과가 없습니다.</td>
                        </tr>

                        <tr th:each="user : ${users}" th:classappend="${user.deleteDate != null} ? 'suspended-row'">

                            <td><input type="checkbox" name="ids" th:value="${user.userId}"></td>
                            <td th:text="${user.userId}">1</td>

                            <td style="font-weight:bold; text-align:left; padding-left:20px;">
                                <span th:text="${user.nickName}">홍길동</span>
                                <span th:if="${user.deleteDate != null}" class="status-label-suspend">정지됨</span>
                            </td>

                            <td th:text="${user.email}">test@email.com</td>
                            <td>
                                <span class="badge" style="background:#eee; color:#555;"
                                      th:text="${user.taste}">돈코츠</span>
                            </td>
                            <td th:text="|${user.age}세|">25세</td>
                            <td>
                                <span class="badge"
                                      th:classappend="${user.gender == 'M'} ? 'male' : 'female'"
                                      th:text="${user.genderLabel}">남</span>
                            </td>
                            <td th:text="${#temporals.format(user.createDate, 'yyyy-MM-dd')}">2026-01-01</td>
                            <td>
                                <button type="button" class="btn-mini"
                                        th:onclick="openUserModal(this)"
                                        th:data-id="${user.userId}"
                                        th:data-email="${user.email}"
                                        th:data-nickname="${user.nickName}"
                                        th:data-taste="${user.taste}"
                                        th:data-age="${user.age}"
                                        th:data-gender="${user.genderLabel}"
                                        th:data-join="${#temporals.format(user.createDate, 'yyyy-MM-dd')}"
                                        th:data-deleted="${user.deleteDate != null}">
                                    관리
                                </button>
                            </td>
                        </tr>
                        </tbody>
                    </table>

                    <div id="userModal" class="modal-overlay" style="display: none;">
                        <div class="modal-window">
                            <div class="modal-header">
                                <h3>회원 상세 관리</h3>
                                <button type="button" class="close-btn" onclick="closeUserModal()">×</button>
                            </div>

                            <div class="modal-body">
                                <div class="info-group">
                                    <label>회원번호</label>
                                    <input type="text" id="modalNo" readonly class="readonly-input">
                                </div>
                                <div class="info-group">
                                    <label>이메일(ID)</label>
                                    <input type="text" id="modalEmail" readonly class="readonly-input">
                                </div>
                                <div class="info-group">
                                    <label>닉네임</label>
                                    <input type="text" id="modalNickname" readonly class="readonly-input">
                                </div>

                                <div class="info-row">
                                    <div class="info-half">
                                        <label>성별</label>
                                        <input type="text" id="modalGender" readonly class="readonly-input">
                                    </div>
                                    <div class="info-half">
                                        <label>나이</label>
                                        <input type="text" id="modalAge" readonly class="readonly-input">
                                    </div>
                                </div>

                                <div class="info-group">
                                    <label>취향 태그</label>
                                    <input type="text" id="modalTaste" readonly class="readonly-input">
                                </div>

                                <div class="info-group">
                                    <label>가입일</label>
                                    <input type="text" id="modalJoinDate" readonly class="readonly-input">
                                </div>

                                <div class="status-section">
                                    <label>현재 상태</label>
                                    <span id="statusBadge" class="badge">정상</span>
                                </div>
                            </div>

                            <div class="modal-footer"
                                 style="justify-content: center; border-top: 1px solid #eee; padding-top: 20px; margin-top: 20px;">
                                <button type="button" id="btnSuspend" class="btn-danger"
                                        onclick="changeStatus('suspend')"
                                        style="width: 100%; height: 45px; font-size: 16px;">
                                    회원 정지 처리
                                </button>

                                <button type="button" id="btnRestore" class="btn-success"
                                        onclick="changeStatus('restore')"
                                        style="display:none; width: 100%; height: 45px; font-size: 16px;">
                                    정지 해제 (복구)
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
            <footer id="footer" th:replace="~{fragments/footer :: footer}"></footer>
        </div>

        <script th:src="@{/js/common.js}"></script>
        <script th:src="@{/js/adminUserList.js}"></script>
    </body>
</html>
