<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8"/>
        <title>식당 인가 관리</title>
        <link rel="stylesheet" th:href="@{/css/reset.css}"/>
        <link rel="stylesheet" th:href="@{/css/common.css}"/>
        <link rel="stylesheet" th:href="@{/css/admin.css}"/>
    </head>
    <body>
        <div id="wrapper">
            <header th:replace="~{fragments/header :: header}"></header>

            <main id="main" class="admin-container">
                <aside th:replace="~{fragments/sidebar :: sidebar(currentMenu='shop')}"></aside>

                <section id="managerRight">
                    <h2 class="page-header">식당 인가 관리</h2>

                    <div class="tab-menu">
                        <a th:href="@{/admin/shops(tab='pending')}"
                           class="tab-item"
                           th:classappend="${currentTab == 'pending'} ? 'active'">승인 대기</a>
                        <a th:href="@{/admin/shops(tab='processed')}"
                           class="tab-item"
                           th:classappend="${currentTab == 'processed'} ? 'active'">처리 내역</a>
                    </div>

                    <div class="list-table-wrap">
                        <table class="list-table">
                            <thead>
                            <tr>
                                <th width="10%">ID</th>
                                <th width="20%">식당명</th>
                                <th width="30%">주소</th>
                                <th width="10%">신청일</th>
                                <th width="10%">상태</th>
                                <th width="20%">관리</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${#lists.isEmpty(shopList)}">
                                <td colspan="6" style="text-align:center; padding: 30px;">데이터가 없습니다.</td>
                            </tr>

                            <tr th:each="shop : ${shopList}">
                                <td th:text="${shop.id}"></td>
                                <td th:text="${shop.name}" style="font-weight:bold;"></td>
                                <td th:text="${shop.address}"></td>
                                <td th:text="${#strings.substring(shop.createDate, 0, 10)}"></td>

                                <td>
                                    <span th:if="${shop.reqType == null or shop.reqType == ''}" class="badge bg-wait">대기중</span>
                                    <span th:if="${shop.reqType == 'Y'}" class="badge bg-green">승인됨</span>
                                    <span th:if="${shop.reqType == 'N'}" class="badge bg-red">거절됨</span>
                                    <span th:if="${shop.reqType == 'P'}" class="badge bg-gray">보류됨</span>
                                </td>

                                <td>
                                    <div th:if="${currentTab == 'pending'}"
                                         style="display:flex; gap:5px; justify-content:center;">
                                        <button class="btn-mini" onclick="processShopDirectly(this, 'APPROVE')"
                                                th:data-id="${shop.id}">승인
                                        </button>
                                        <button class="btn-mini red" onclick="processShopDirectly(this, 'REJECT')"
                                                th:data-id="${shop.id}">거절
                                        </button>
                                        <button class="btn-mini" style="background-color:#6c757d; color:white;"
                                                onclick="processShopDirectly(this, 'HOLD')" th:data-id="${shop.id}">보류
                                        </button>
                                    </div>

                                    <div th:if="${currentTab == 'processed'}">
                                        <button class="btn-mini"
                                                th:onclick="openStatusModal([[${shop.id}]], [[${shop.name}]], [[${shop.reqType}]])">
                                            상태 변경
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="pagination-area" th:if="${pagination.totalCount > 0}">
                        <ul class="pagination">

                            <li th:if="${pagination.page > 1}">
                                <a th:href="@{/admin/shops(tab=${currentTab}, page=${pagination.page - 1})}">
                                    &lt;
                                </a>
                            </li>

                            <li th:each="pageNum : ${#numbers.sequence(pagination.startPage, pagination.endPage)}"
                                th:classappend="${pageNum == pagination.page} ? 'active'">
                                <a th:href="@{/admin/shops(tab=${currentTab}, page=${pageNum})}"
                                   th:text="${pageNum}">1</a>
                            </li>

                            <li th:if="${pagination.page < pagination.totalPage}">
                                <a th:href="@{/admin/shops(tab=${currentTab}, page=${pagination.page + 1})}">
                                    &gt;
                                </a>
                            </li>
                        </ul>
                    </div>
                </section>

                <div id="statusModal" class="modal-overlay" style="display: none;">
                    <div class="modal-window" style="width: 400px;">
                        <div class="modal-header">
                            <h3>승인 상태 변경</h3>
                            <button class="close-btn" onclick="closeModal('statusModal')">×</button>
                        </div>
                        <div class="modal-body">
                            <input type="hidden" id="modalShopId">

                            <div class="info-group">
                                <label>식당명</label>
                                <input type="text" id="modalShopName" class="input-style" readonly
                                       style="background:#f9f9f9;">
                            </div>

                            <div class="info-group">
                                <label>처리 상태 선택</label>
                                <div class="radio-group">
                                    <label class="radio-item">
                                        <input type="radio" name="statusType" value="APPROVE" id="radioApprove">
                                        <span style="color:#28a745; font-weight:bold;">승인 (Y)</span>
                                    </label>
                                    <label class="radio-item">
                                        <input type="radio" name="statusType" value="REJECT" id="radioReject">
                                        <span style="color:#dc3545; font-weight:bold;">거절 (N)</span>
                                    </label>
                                    <label class="radio-item">
                                        <input type="radio" name="statusType" value="HOLD" id="radioHold">
                                        <span style="color:#6c757d; font-weight:bold;">보류 (P)</span>
                                    </label>
                                </div>
                            </div>
                            <p style="margin-top:15px; font-size:13px; color:#666;">
                                ※ 상태를 변경하면 즉시 반영됩니다.
                            </p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn-primary" onclick="updateStatusFromModal()">변경 저장</button>
                        </div>
                    </div>
                </div>

            </main>
        </div>

        <script th:src="@{/js/adminShop.js}"></script>
    </body>
</html>
