<header id="header" th:fragment="header" xmlns:th="http://www.thymeleaf.org">
    <div class="inner">
        <div id="logo">
            <a th:href="@{/}"><img th:src="@{/img/raFeed_Logo-Photoroom.png}" alt="RaFeed_Logo"/></a>
        </div>
        <div class="navigation">
            <ul class="navMenu">
                <li><a th:href="@{/origin}">유래</a></li>
                <li><a th:href="@{/shop}">지역별/테마별</a></li>
                <li><a th:href="@{/board/news}">뉴스</a></li>
                <li><a th:href="@{/board/boardList}">게시판</a></li>
                <li><a th:href="@{/approval}">식당신청</a></li>
            </ul>
        </div>
        <div class="headerContent">
            <div id="user">
                <div id="guestBox" class="userBox"
                     th:if="${!#authorization.expression('isAuthenticated()')}">
                    <p><a th:href="@{/login}">로그인</a></p>
                    <span>|</span>
                    <p><a th:href="@{/login/register}">회원가입</a></p>
                </div>
                <div id="loginBox" class="userBox"
                     th:if="${#authorization.expression('isAuthenticated()')}">
                    <p><span id="userNickname" th:text="${#authentication?.principal?.nickname}"></span>님 안녕하세요</p>
                    <span>|</span>
                    <p><a id="mypageLink" href="#">마이 페이지</a></p>
                    <span>|</span>
                    <p><a href="javascript:void(0)" id="logoutBtn">로그아웃</a></p>
                </div>
            </div>
            <div class="searchWrap">
                <input type="text" id="search" placeholder=" Search..."/>
                <button id="search-button">
                    <img th:src="@{/img/ico-search-wh-56x56.png}" alt="Search"/>
                </button>
            </div>
        </div>
    </div>

    <script>
        (function syncAccessTokenCookie() {
            try {
                const token = localStorage.getItem('accessToken');
                if (!token) return;

                const hasCookie = document.cookie.split(';').some(c => c.trim().startsWith('accessToken='));
                if (!hasCookie) {
                    document.cookie = `accessToken=${token}; Path=/`;

                    // 최초 1회만 새로고침해서 서버 렌더링(isAuthenticated)이 반영되게 함
                    const reloaded = sessionStorage.getItem('tokenCookieSynced');
                    if (!reloaded) {
                        sessionStorage.setItem('tokenCookieSynced', '1');
                        location.reload();
                    }
                }
            } catch (e) {
                // ignore
            }
        })();
    </script>
</header>
